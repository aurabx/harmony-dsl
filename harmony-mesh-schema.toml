# Harmony Proxy Mesh Configuration Schema DSL
# This schema defines the structure and validation rules for harmony-proxy mesh files
# It can be parsed and validated in both Rust (harmony-proxy) and PHP (runbeam cloud API)

[schema]
version = "1.10.0"
description = "Harmony Proxy mesh configuration schema for data mesh networking"

# ========================================================================================
# MESH TABLE - Mesh definitions (multiple instances)
# ========================================================================================
[[table]]
name = "mesh.*"
pattern = true
pattern_constraint = "^[a-z0-9_-]+$"
required = false
description = "Mesh definition linking ingress and egress points for inter-proxy communication"

[[table.field]]
name = "id"
type = "string"
required = false
description = "Optional unique identifier for this mesh"

[[table.field]]
name = "type"
type = "string"
required = true
enum = ["http", "http3"]
description = "Protocol type for mesh communication"

[[table.field]]
name = "provider"
type = "string"
required = true
enum = ["local", "runbeam"]
description = "Mesh provider - 'local' for self-managed mesh with local certificates, 'runbeam' for Runbeam Cloud managed mesh"

[[table.field]]
name = "auth_type"
type = "string"
required = false
enum = ["jwt"]
default = "jwt"
description = "Authentication type for mesh members. Currently only 'jwt' is supported."

[[table.field]]
name = "jwt_secret"
type = "string"
required = false
description = "JWT secret for HS256 symmetric key authentication. Used for both signing (egress) and verification (ingress). Required for local provider if RSA keys are not configured."

[[table.field]]
name = "jwt_private_key_path"
type = "string"
required = false
description = "Path to RSA private key (PEM format) for RS256 JWT signing on egress. Used with local provider for asymmetric authentication."

[[table.field]]
name = "jwt_public_key_path"
type = "string"
required = false
description = "Path to RSA public key (PEM format) for RS256 JWT verification on ingress. Used with local provider for asymmetric authentication."

[[table.field]]
name = "ingress"
type = "array"
array_item_type = "string"
required = true
min_items = 1
description = "List of ingress definition names that belong to this mesh"

[[table.field]]
name = "egress"
type = "array"
array_item_type = "string"
required = true
min_items = 1
description = "List of egress definition names that belong to this mesh"

[[table.field]]
name = "description"
type = "string"
required = false
description = "Human-readable description of this mesh"

[[table.field]]
name = "enabled"
type = "boolean"
required = false
default = true
description = "Whether this mesh is currently active"

